<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Carboclor Storage Dashboard</title>

<style>

body{
    background:#020617;
    color:#e2e8f0;
    font-family:Segoe UI,Arial;
    margin:30px;
}

h1{
    font-weight:300;
    letter-spacing:1px;
}

.filters{
    margin:20px 0;
}

select{
    background:#0f172a;
    color:white;
    border:1px solid #334155;
    padding:8px;
    margin-right:10px;
}

.tank{
    background:#020617;
    border-left:5px solid #334155;
    padding:15px;
    margin-bottom:12px;
}

.header{
    display:flex;
    justify-content:space-between;
    font-size:18px;
}

.product{
    color:#94a3b8;
}

.bar{
    height:28px;
    background:#1e293b;
    margin-top:10px;
    border-radius:4px;
    overflow:hidden;
}

.fill{
    height:100%;
    display:flex;
    align-items:center;
    justify-content:flex-end;
    padding-right:10px;
    font-weight:bold;
}

.meta{
    margin-top:8px;
    display:flex;
    gap:30px;
    font-size:13px;
    color:#cbd5e1;
}

</style>
</head>

<body>

<h1>CARBOCLOR TERMINAL STATUS</h1>

<div class="filters">
<select id="productFilter">
<option value="">Todos los productos</option>
</select>
</div>

<div id="dashboard"></div>

<script>

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSdyOrnlQBDihM-vR3ylD5hyWkwahrugTXpi_tEeEwRxXZiNIEGlZ2VMZvwJ3gkzxHF2XNcFXMQApun/pub?gid=1349722585&single=true&output=csv";

let tanks=[];

async function loadData(){

    const res = await fetch(CSV_URL + "&t=" + new Date().getTime());
    const text = await res.text();

    const rows = text.trim().split("\n").map(r=>r.split(","));

    rows.shift(); // headers

    tanks = rows.map(r=>({

        tank:r[0],
        capacity:parseFloat(r[1]),
        product:r[2],
        stock:parseFloat(r[3]),
        density:parseFloat(r[4]),
        util:parseFloat(r[5]),
        volume:parseFloat(r[6]),
        available:parseFloat(r[7])

    }));

    buildFilters();
    render();
}

function buildFilters(){

    const sel=document.getElementById("productFilter");

    const products=[...new Set(tanks.map(t=>t.product))];

    products.forEach(p=>{
        sel.innerHTML+=`<option>${p}</option>`;
    });

    sel.onchange=render;
}

function color(u){

    if(u>=90) return "#ef4444";
    if(u>=70) return "#f59e0b";
    if(u>=40) return "#22c55e";
    return "#38bdf8";
}

function render(){

    const filter=document.getElementById("productFilter").value;

    const container=document.getElementById("dashboard");
    container.innerHTML="";

    tanks
    .filter(t=>!filter || t.product===filter)
    .sort((a,b)=>b.util-a.util)
    .forEach(t=>{

        const pct=Math.min(100,t.util);

        const el=document.createElement("div");
        el.className="tank";

        el.innerHTML=`

        <div class="header">
            <div><b>TK ${t.tank}</b></div>
            <div>${pct.toFixed(1)}%</div>
        </div>

        <div class="product">${t.product}</div>

        <div class="bar">
            <div class="fill"
                style="width:${pct}%;
                       background:${color(pct)}">
                ${pct.toFixed(1)}%
            </div>
        </div>

        <div class="meta">
            <div>Stock: ${Math.round(t.stock).toLocaleString()} kg</div>
            <div>Capacidad: ${t.capacity} m³</div>
            <div>Disponible: ${Math.round(t.available).toLocaleString()} m³</div>
        </div>
        `;

        container.appendChild(el);
    });
}

loadData();

/* AUTO REFRESH cada 60 segundos */
setInterval(loadData,60000);

</script>

</body>
</html>
